<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (11.0.2) on Thu Sep 21 21:59:30 PDT 2023 -->
<title>org.apache.lucene.search.join (Lucene 9.8.0 join API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2023-09-21">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery/jquery-ui.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../../jquery/jquery-3.3.1.js"></script>
<script type="text/javascript" src="../../../../../jquery/jquery-migrate-3.0.1.js"></script>
<script type="text/javascript" src="../../../../../jquery/jquery-ui.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="org.apache.lucene.search.join (Lucene 9.8.0 join API)";
        }
    }
    catch(err) {
    }
//-->
var pathtoroot = "../../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<main role="main">
<div class="header">
<h1 title="Package" class="title">Package&nbsp;org.apache.lucene.search.join</h1>
</div>
<div class="contentContainer">
<section role="region"><a id="package.description">
<!--   -->
</a>
<div class="block">Support for index-time and query-time joins.

 <h2>Index-time joins</h2>

 <p>The index-time joining support joins while searching, where joined documents are indexed as a
 single document block using <a href="../../../../../../core/org/apache/lucene/index/IndexWriter.html?is-external=true#addDocuments(java.lang.Iterable)" title="class or interface in org.apache.lucene.index" class="externalLink"><code>IndexWriter.addDocuments()</code></a>. This is useful for any normalized content (XML documents or database
 tables). In database terms, all rows for all joined tables matching a single row of the primary
 table must be indexed as a single document block, with the parent document being last in the
 group.

 <p>When you index in this way, the documents in your index are divided into parent documents (the
 last document of each block) and child documents (all others). You provide a <a href="BitSetProducer.html" title="interface in org.apache.lucene.search.join"><code>BitSetProducer</code></a> that identifies the parent documents, as Lucene
 does not currently record any information about doc blocks.

 <p>At search time, use <a href="ToParentBlockJoinQuery.html" title="class in org.apache.lucene.search.join"><code>ToParentBlockJoinQuery</code></a> to remap/join
 matches from any child <a href="../../../../../../core/org/apache/lucene/search/Query.html?is-external=true" title="class or interface in org.apache.lucene.search" class="externalLink"><code>Query</code></a> (ie, a query that matches only
 child documents) up to the parent document space. The resulting query can then be used as a
 clause in any query that matches parent.

 <p>If you care about what child documents matched for each parent document, then use the <a href="ParentChildrenBlockJoinQuery.html" title="class in org.apache.lucene.search.join"><code>ParentChildrenBlockJoinQuery</code></a> query to per matched parent document
 retrieve the child documents that caused to match the parent document in first place. This query
 should be used after your main query has been executed. For each hit execute the the <a href="ParentChildrenBlockJoinQuery.html" title="class in org.apache.lucene.search.join"><code>ParentChildrenBlockJoinQuery</code></a> query

 <pre class="prettyprint">
   TopDocs results = searcher.search(mainQuery, 10);
   for (int i = 0; i &lt; results.scoreDocs.length; i++) {
     ScoreDoc scoreDoc = results.scoreDocs[i];

     // Run ParentChildrenBlockJoinQuery to figure out the top matching child docs:
     ParentChildrenBlockJoinQuery parentChildrenBlockJoinQuery =
       new ParentChildrenBlockJoinQuery(parentFilter, childQuery, scoreDoc.doc);
     TopDocs topChildResults = searcher.search(parentChildrenBlockJoinQuery, 3);
     // Process top child hits...
   }
 </pre>

 <p>To map/join in the opposite direction, use <a href="ToChildBlockJoinQuery.html" title="class in org.apache.lucene.search.join"><code>ToChildBlockJoinQuery</code></a>. This wraps any query matching parent
 documents, creating the joined query matching only child documents.

 <h2>Query-time joins</h2>

 <p>The query time joining is index term based and implemented as two pass search. The first pass
 collects all the terms from a fromField that match the fromQuery. The second pass returns all
 documents that have matching terms in a toField to the terms collected in the first pass.

 <p>Query time joining has the following input:

 <ul>
   <li><code>fromField</code>: The from field to join from.
   <li><code>fromQuery</code>: The query executed to collect the from terms. This is usually the
       user specified query.
   <li><code>multipleValuesPerDocument</code>: Whether the fromField contains more than one value
       per document
   <li><code>scoreMode</code>: Defines how scores are translated to the other join side. If you
       don't care about scoring use <a href="ScoreMode.html#None"><code>ScoreMode.None</code></a> mode.
       This will disable scoring and is therefore more efficient (requires less memory and is
       faster).
   <li><code>toField</code>: The to field to join to
 </ul>

 <p>Basically the query-time joining is accessible from one static method. The user of this method
 supplies the method with the described input and a <code>IndexSearcher</code> where the from
 terms need to be collected from. The returned query can be executed with the same <code>
 IndexSearcher</code>, but also with another <code>IndexSearcher</code>. Example usage of the
 <a href="JoinUtil.html#createJoinQuery(java.lang.String,boolean,java.lang.String,org.apache.lucene.search.Query,org.apache.lucene.search.IndexSearcher,org.apache.lucene.search.join.ScoreMode)"><code>JoinUtil.createJoinQuery()</code></a> :

 <pre class="prettyprint">
   String fromField = "from"; // Name of the from field
   boolean multipleValuesPerDocument = false; // Set only to true in the case when your fromField has multiple values per document in your index
   String toField = "to"; // Name of the to field
   ScoreMode scoreMode = ScoreMode.Max; // Defines how the scores are translated into the other side of the join.
   Query fromQuery = new TermQuery(new Term("content", searchTerm)); // Query executed to collect from values to join to the to values

   Query joinQuery = JoinUtil.createJoinQuery(fromField, multipleValuesPerDocument, toField, fromQuery, fromSearcher, scoreMode);
   TopDocs topDocs = toSearcher.search(joinQuery, 10); // Note: toSearcher can be the same as the fromSearcher
   // Render topDocs...
 </pre></div>
</section>
<ul class="blockList">
<li class="blockList">
<table class="typeSummary">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="BitSetProducer.html" title="interface in org.apache.lucene.search.join">BitSetProducer</a></th>
<td class="colLast">
<div class="block">A producer of <a href="../../../../../../core/org/apache/lucene/util/BitSet.html?is-external=true" title="class or interface in org.apache.lucene.util" class="externalLink"><code>BitSet</code></a>s per segment.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="BlockJoinSelector.html" title="class in org.apache.lucene.search.join">BlockJoinSelector</a></th>
<td class="colLast">
<div class="block">Select a value from a block of documents.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="CheckJoinIndex.html" title="class in org.apache.lucene.search.join">CheckJoinIndex</a></th>
<td class="colLast">
<div class="block">Utility class to check a block join index.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="DiversifyingChildrenByteKnnVectorQuery.html" title="class in org.apache.lucene.search.join">DiversifyingChildrenByteKnnVectorQuery</a></th>
<td class="colLast">
<div class="block">kNN byte vector query that joins matching children vector documents with their parent doc id.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="DiversifyingChildrenFloatKnnVectorQuery.html" title="class in org.apache.lucene.search.join">DiversifyingChildrenFloatKnnVectorQuery</a></th>
<td class="colLast">
<div class="block">kNN float vector query that joins matching children vector documents with their parent doc id.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="JoinUtil.html" title="class in org.apache.lucene.search.join">JoinUtil</a></th>
<td class="colLast">
<div class="block">Utility for query time joining.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="ParentChildrenBlockJoinQuery.html" title="class in org.apache.lucene.search.join">ParentChildrenBlockJoinQuery</a></th>
<td class="colLast">
<div class="block">A query that returns all the matching child documents for a specific parent document indexed
 together in the same block.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="QueryBitSetProducer.html" title="class in org.apache.lucene.search.join">QueryBitSetProducer</a></th>
<td class="colLast">
<div class="block">A <a href="BitSetProducer.html" title="interface in org.apache.lucene.search.join"><code>BitSetProducer</code></a> that wraps a query and caches matching <a href="../../../../../../core/org/apache/lucene/util/BitSet.html?is-external=true" title="class or interface in org.apache.lucene.util" class="externalLink"><code>BitSet</code></a>s per segment.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="SeekingTermSetTermsEnum.html" title="class in org.apache.lucene.search.join">SeekingTermSetTermsEnum</a></th>
<td class="colLast">
<div class="block">A filtered TermsEnum that uses a BytesRefHash as a filter</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="ToChildBlockJoinQuery.html" title="class in org.apache.lucene.search.join">ToChildBlockJoinQuery</a></th>
<td class="colLast">
<div class="block">Just like <a href="ToParentBlockJoinQuery.html" title="class in org.apache.lucene.search.join"><code>ToParentBlockJoinQuery</code></a>, except this query joins in reverse: you provide a Query
 matching parent documents and it joins down to child documents.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="ToParentBlockJoinQuery.html" title="class in org.apache.lucene.search.join">ToParentBlockJoinQuery</a></th>
<td class="colLast">
<div class="block">This query requires that you index children and parent docs as a single block, using the <a href="../../../../../../core/org/apache/lucene/index/IndexWriter.html?is-external=true#addDocuments(java.lang.Iterable)" title="class or interface in org.apache.lucene.index" class="externalLink"><code>IndexWriter.addDocuments()</code></a> or <a href="../../../../../../core/org/apache/lucene/index/IndexWriter.html?is-external=true#updateDocuments(org.apache.lucene.index.Term,java.lang.Iterable)" title="class or interface in org.apache.lucene.index" class="externalLink"><code>IndexWriter.updateDocuments()</code></a> API.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="ToParentBlockJoinSortField.html" title="class in org.apache.lucene.search.join">ToParentBlockJoinSortField</a></th>
<td class="colLast">
<div class="block">A special sort field that allows sorting parent docs based on nested / child level fields.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary">
<caption><span>Enum Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Enum</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="BlockJoinSelector.Type.html" title="enum in org.apache.lucene.search.join">BlockJoinSelector.Type</a></th>
<td class="colLast">
<div class="block">Type of selection to perform.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="ScoreMode.html" title="enum in org.apache.lucene.search.join">ScoreMode</a></th>
<td class="colLast">
<div class="block">How to aggregate multiple child hit scores into a single parent score.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</main>
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small><i>Copyright &copy; 2000-2023 Apache Software Foundation. All Rights Reserved.</i></small></p>
</footer>
</body>
</html>
