<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (11.0.2) on Thu Sep 21 21:59:36 PDT 2023 -->
<title>org.apache.lucene.demo.facet (Lucene 9.8.0 demo API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2023-09-21">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery/jquery-ui.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../../jquery/jquery-3.3.1.js"></script>
<script type="text/javascript" src="../../../../../jquery/jquery-migrate-3.0.1.js"></script>
<script type="text/javascript" src="../../../../../jquery/jquery-ui.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="org.apache.lucene.demo.facet (Lucene 9.8.0 demo API)";
        }
    }
    catch(err) {
    }
//-->
var pathtoroot = "../../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<main role="main">
<div class="header">
<h1 title="Package" class="title">Package&nbsp;org.apache.lucene.demo.facet</h1>
</div>
<div class="contentContainer">
<section role="region"><a id="package.description">
<!--   -->
</a>
<div class="block">Facet Userguide and Demo.

 <h2>Table of Contents</h2>

 <ol>
   <li><a href="#intro">Introduction</a>
   <li><a href="#facet_features">Facet Features</a>
       <ol>
         <li><a href="#facet_sounting">Facet Counting</a>
         <li><a href="#facet_association">Facet Associations</a>
       </ol>
   <li><a href="#facet_indexing">Indexing Categories Illustrated</a>
   <li><a href="#facet_collection">Collecting Facets Illustrated</a>
   <li><a href="#indexed_facet_info">Indexed Facet Information</a>
       <ol>
         <li><a href="#category_terms_field">Category Terms Field</a>
         <li><a href="#category_list_field">Category List Field</a>
       </ol>
   <li><a href="#taxonomy_index">Taxonomy Index</a>
   <li><a href="#facet_config">Facet Configuration</a>
   <li><a href="#advanced">Advanced Faceted Examples</a>
       <ol>
         <li><a href="#drill_down">Drill-Down with Regular Facets</a>
         <li><a href="#multi-category_list">Multiple Category Lists</a>
         <li><a href="#sampling">Sampling</a>
       </ol>
   <li><a href="#concurrent_indexing_search">Concurrent Indexing and Search</a>
   <li><a href="#demo">All demo packages and classes</a>
 </ol>

 <h2 id="intro">Introduction</h2>

 <p>A category is an aspect of indexed documents which can be used to classify the documents. For
 example, in a collection of books at an online bookstore, categories of a book can be its price,
 author, publication date, binding type, and so on.

 <p>In faceted search, in addition to the standard set of search results, we also get facet
 results, which are lists of subcategories for certain categories. For example, for the price
 facet, we get a list of relevant price ranges; for the author facet, we get a list of relevant
 authors; and so on. In most UIs, when users click one of these subcategories, the search is
 narrowed, or drilled down, and a new search limited to this subcategory (e.g., to a specific
 price range or author) is performed.

 <p>Note that faceted search is more than just the ordinary fielded search. In fielded search,
 users can add search keywords like price:10 or author:"Mark Twain" to the query to narrow the
 search, but this requires knowledge of which fields are available, and which values are worth
 trying. This is where faceted search comes in: it provides a list of useful subcategories, which
 ensures that the user only drills down into useful subcategories and never into a category for
 which there are no results. In essence, faceted search makes it easy to navigate through the
 search results. The list of subcategories provided for each facet is also useful to the user in
 itself, even when the user never drills down. This list allows the user to see at one glance some
 statistics on the search results, e.g., what price ranges and which authors are most relevant to
 the given query.

 <p>In recent years, faceted search has become a very common UI feature in search engines,
 especially in e-commerce websites. Faceted search makes it easy for untrained users to find the
 specific item they are interested in, whereas manually adding search keywords (as in the examples
 above) proved too cumbersome for ordinary users, and required too much guesswork,
 trial-and-error, or the reading of lengthy help pages.

 <p>See <a href="http://en.wikipedia.org/wiki/Faceted_search">http://en.wikipedia.org/wiki/Faceted_search</a>
 for more information on faceted search.

 <h2 id="facet_features">Facet Features</h2>

 First and main faceted search capability that comes to mind is counting, but in fact faceted
 search is more than facet counting. We now briefly discuss the available faceted search features.

 <h3 id="facet_sounting">Facet Counting</h3>

 <p>Which of the available subcategories of a facet should a UI display? A query in a book store
 might yield books by a hundred different authors, but normally we'd want do display only, say,
 ten of those.

 <p>Most available faceted search implementations use counts to determine the importance of each
 subcategory. These implementations go over all search results for the given query, and count how
 many results are in each subcategory. Finally, the subcategories with the most results can be
 displayed. So the user sees the price ranges, authors, and so on, for which there are most
 results. Often, the count is displayed next to the subcategory name, in parentheses, telling the
 user how many results he can expect to see if he drills down into this subcategory.

 <p>The main API for obtaining facet counting is <a href="../../../../../../facet/org/apache/lucene/facet/Facets.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>Facets</code></a>.

 <p>Code examples can be found in <a href="../../../../../src-html/org/apache/lucene/demo/facet/SimpleFacetsExample.html">SimpleFacetsExample.java</a>,
 see details in <a href="#facet_collection">Collecting Facets</a> section.

 <h3 id="facet_association">Facet Associations</h3>

 <p>So far we've discussed categories as binary features, where a document either belongs to a
 category, or not.

 <p>While counts are useful in most situations, they are sometimes not sufficiently informative
 for the user, with respect to deciding which subcategory is more important to display.

 <p>For this, the facets package allows to associate a value with a category. The search time
 interpretation of the associated value is application dependent. For example, a possible
 interpretation is as a <i>match level</i> (e.g., confidence level). This value can then be used
 so that a document that is very weakly associated with a certain category will only contribute
 little to this category's aggregated weight.

 <h2 id="facet_indexing">Indexing Categories Illustrated</h2>

 <p>In order to find facets at search time they must first be added to the index at indexing time.
 Recall that Lucene documents are made of fields. To index document categories you use special
 field, <a href="../../../../../../facet/org/apache/lucene/facet/FacetField.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetField</code></a>. The field requires following parameters:

 <ul>
   <li>Facet <b>dimension</b>, for example <i>author</i> or <i>publication date</i>.
   <li>Facet <b>path</b> from root to a leaf for the current document. For example, for
       <i>publication date</i> dimension the path can be <i>&lt;"2010", "07", "28"&gt;</i>.
       Constructed this way, this path allows us to refine search or counting for all books,
       published in the same year, or in the same year and month.
 </ul>

 From taxonomy point of view, <i>dimension</i> is just a root element - or the top, the first
 element - in a category path. Indeed, the dimension stands out as a top important part of the
 category path, such as <code>"Location"</code> for the category <code>
 "Location/Europe/France/Paris"</code>.

 <p>After all facet fields are added to the document, you should translate them into "normal"
 fields for indexing and, if required, updates taxonomy index. To do that, you need to call <a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.html?is-external=true#build(org.apache.lucene.facet.taxonomy.TaxonomyWriter,org.apache.lucene.document.Document)" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetsConfig.build(...)</code></a>. Before building, you might want to
 customize the per-dimension facets configuration, see details in <a href="#indexed_facet_info">Indexed Facet Information</a>.

 <p>Indexing of each document therefore usually goes like this:

 <ul>
   <li>Create a fresh (empty) Lucene Document.
   <li>Parse input attributes and add appropriate index fields.
   <li>Add all input categories associated with the document as <a href="../../../../../../facet/org/apache/lucene/facet/FacetField.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetField</code></a> fields to the Lucene document.
   <li>Build <a href="../../../../../../facet/org/apache/lucene/facet/FacetField.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink">facet fields</a> with <a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.html?is-external=true#build(org.apache.lucene.facet.taxonomy.TaxonomyWriter,org.apache.lucene.document.Document)" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetsConfig.build(...)</code></a>. This actually adds the
       categories to the Lucene document and, if required, updates taxonomy to contain the newly
       added categories (if not already there) - see more on this in the section about the <a href="#taxonomy_index">Taxonomy Index</a> below.
   <li>Add the document to the index. As a result, category info is saved also in the regular
       search index, for supporting facet aggregation at search time (e.g. facet counting) as well
       as facet drill-down. For more information on indexed facet information see below the
       section <a href="#indexed_facet_info">Indexed Facet Information</a>.
 </ul>

 There is a category indexing code example in <a href="SimpleFacetsExample.html#index()"><code>SimpleFacetsExample.index()</code></a>, see <a href="../../../../../src-html/org/apache/lucene/demo/facet/SimpleFacetsExample.html">SimpleFacetsExample.java
 source code</a>.

 <h2 id="facet_collection">Collecting Facets Illustrated</h2>

 <p>Facets collection reflects a set of documents over some facet requests:

 <ul>
   <li>Document set - a subset of the index documents, usually documents matching a user query.
   <li>Facet requests - facet collection specification, e.g. count a certain facet
       <i>dimension</i>.
 </ul>

 <p><a href="../../../../../../facet/org/apache/lucene/facet/Facets.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>Facets</code></a> is a basic component in faceted search. It provides
 multiple methods to get facet results, most of these methods take <i>dimension</i> and
 <i>path</i> which correspond to dimensions and paths of indexed documents, see <a href="#facet_indexing">Indexing Categories</a>. For example, <a href="../../../../../../facet/org/apache/lucene/facet/Facets.html?is-external=true#getTopChildren(int,java.lang.String,java.lang.String...)" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>getTopChildren(10, "Publish Date", "2010", "07")</code></a> can be used to return top 10 labels for books
 published in July 2010.

 <p><a href="../../../../../../facet/org/apache/lucene/facet/Facets.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>Facets</code></a> in an abstract class, open for extensions. The most
 often used implementation is <a href="../../../../../../facet/org/apache/lucene/facet/taxonomy/FastTaxonomyFacetCounts.html?is-external=true" title="class or interface in org.apache.lucene.facet.taxonomy" class="externalLink"><code>FastTaxonomyFacetCounts</code></a>, it
 is used for counting facets.

 <p><b>NOTE</b> You must make sure that <a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetsConfig</code></a> used for
 searching matches the one that was used for indexing.

 <p>Facet collectors collect hits for subsequent faceting. The most commonly used one is <a href="../../../../../../facet/org/apache/lucene/facet/FacetsCollector.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetsCollector</code></a>. The collectors extend <a href="../../../../../../core/org/apache/lucene/search/Collector.html?is-external=true" title="class or interface in org.apache.lucene.search" class="externalLink"><code>Collector</code></a>, and as such can be passed to the search() method of Lucene's
 <a href="../../../../../../core/org/apache/lucene/search/IndexSearcher.html?is-external=true" title="class or interface in org.apache.lucene.search" class="externalLink"><code>IndexSearcher</code></a>. In case the application also needs to collect
 documents (in addition to accumulating/collecting facets), you can use one of <a href="../../../../../../facet/org/apache/lucene/facet/FacetsCollector.html?is-external=true#search(org.apache.lucene.search.IndexSearcher,org.apache.lucene.search.Query,int,org.apache.lucene.search.Collector)" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetsCollector.search(...)</code></a> utility methods.

 <p>There is a facets collecting code example in <a href="SimpleFacetsExample.html#facetsWithSearch()"><code>SimpleFacetsExample.facetsWithSearch()</code></a>, see <a href="../../../../../src-html/org/apache/lucene/demo/facet/SimpleFacetsExample.html">SimpleFacetsExample.java
 source code</a>.

 <p>Returned <a href="../../../../../../facet/org/apache/lucene/facet/FacetResult.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetResult</code></a> instances contain:

 <ul>
   <li>Requested <a href="../../../../../../facet/org/apache/lucene/facet/FacetResult.html?is-external=true#dim" title="class or interface in org.apache.lucene.facet" class="externalLink">dimension</a> and <a href="../../../../../../facet/org/apache/lucene/facet/FacetResult.html?is-external=true#path" title="class or interface in org.apache.lucene.facet" class="externalLink">path</a>.
   <li>Total <a href="../../../../../../facet/org/apache/lucene/facet/FacetResult.html?is-external=true#value" title="class or interface in org.apache.lucene.facet" class="externalLink">number of documents</a> containing
       a value for this path and <a href="../../../../../../facet/org/apache/lucene/facet/FacetResult.html?is-external=true#childCount" title="class or interface in org.apache.lucene.facet" class="externalLink">number
       of child labels encountered</a>.
   <li>And last but not least, <a href="../../../../../../facet/org/apache/lucene/facet/FacetResult.html?is-external=true#labelValues" title="class or interface in org.apache.lucene.facet" class="externalLink">children labels and counts</a>.
 </ul>

 <h2 id="indexed_facet_info">Indexed Facet Information</h2>

 <p>When indexing a document with facet fields (categories), information on these categories is
 added to the search index, in two locations:

 <h3 id="category_terms_field">Category Terms Field</h3>

 Category terms, or drill-down terms, are added to the document that contains facets fields. These
 categories can be used at search time for drill-down.

 <p><a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetsConfig</code></a> has a per-dimension config of the Category Terms
 field, e.g. you can choose to <a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.DrillDownTermsIndexing.html?is-external=true#NONE" title="class or interface in org.apache.lucene.facet" class="externalLink">not index them at all</a> or
 <a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.DrillDownTermsIndexing.html?is-external=true#ALL" title="class or interface in org.apache.lucene.facet" class="externalLink">index dimension, all
 sub-paths and full path</a>, default config). For example, indexing a document with a dimension
 <code>"author"</code> and path <code>&lt;"American", "Mark Twain"&gt;</code> results in creating
 three tokens: <code>"/author"</code>, <code>"/author/American"</code>, and <code>
 "/author/American/Mark Twain"</code> (the character <code>'/'</code> here is just a
 human-readable separator, there's no such element in the actual index). This allows drilling down
 any category in the taxonomy, and not just leaf nodes.

 <h3 id="category_list_field">Category List Field</h3>

 Category List field is added to each document containing information on the categories that were
 added to this document. This can be used at search time for facet accumulation, e.g. facet
 counting.

 <p>If dimension is hierarchical (see <a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.DimConfig.html?is-external=true#hierarchical" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetsConfig.DimConfig.hierarchical</code></a>), the field allows counting any
 sub-category in the taxonomy, and not just leaf nodes, e.g. in the example above it enables a UI
 application to show either how many books have authors, or how many books have American authors,
 or how many books have Mark Twain as their (American) author.

 <p>If separate taxonomy index is used (see <a href="#taxonomy_index">Taxonomy Index</a> for when
 it's not), in order to keep the counting list compact, Category List field is built using
 category ordinal - an ordinal is an integer number attached to a category when it is added for
 the first time into the taxonomy.

 <p>For ways to further alter facet index see the section below on <a href="#indexing_params">Facet Indexing Parameters</a>.

 <h2 id="taxonomy_index">Taxonomy Index</h2>

 <p>The taxonomy is an auxiliary data-structure that can be maintained side-by-side with the
 regular index to support faceted search operations. It contains information about all the
 categories that ever existed in any document in the index. Its API is open and allows simple
 usage, or more advanced for the interested users.

 <p>Not all Facet field types use Taxonomy Index to store data. <a href="../../../../../../facet/org/apache/lucene/facet/sortedset/SortedSetDocValuesFacetField.html?is-external=true" title="class or interface in org.apache.lucene.facet.sortedset" class="externalLink"><code>SortedSetDocValuesFacetField</code></a> writes taxonomy data as a <a href="../../../../../../core/org/apache/lucene/index/SortedSetDocValues.html?is-external=true" title="class or interface in org.apache.lucene.index" class="externalLink"><code>SortedSetDocValues</code></a> field in the regular index, therefore if you only use
 these fields for taxonomy, you don't need taxonomy index and its writer. All details in this
 section below are only applicable to cases where Taxonomy Index is created.

 <p>When <a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.html?is-external=true#build(org.apache.lucene.facet.taxonomy.TaxonomyWriter,org.apache.lucene.document.Document)" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetsConfig.build(...)</code></a> is called on a document with
 <a href="../../../../../../facet/org/apache/lucene/facet/FacetField.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink">facet fields</a>, a corresponding node is added to
 the taxonomy index (unless already there). In fact, sometimes more than one node is added - each
 parent category is added as well, so that the taxonomy is maintained as a Tree, with a virtual
 root.

 <p>So, for the above example, adding the category <code>
 &lt;"author", "American", "Mark Twain"&gt;</code> actually added three nodes: one for the
 dimension <code>"/author"</code>, one for <code>"/author/American"</code> and one for <code>
 "/author/American/Mark Twain"</code>.

 <p>An integer number - called ordinal is attached to each category the first time the category is
 added to the taxonomy. This allows for a compact representation of category list tokens in the
 index, for facets accumulation.

 <p>One interesting fact about the taxonomy index is worth knowing: once a category is added to
 the taxonomy, it is never removed, even if all related documents are removed. This differs from a
 regular index, where if all documents containing a certain term are removed, and their segments
 are merged, the term will also be removed. This might cause a performance issue: large taxonomy
 means large ordinal numbers for categories, and hence large categories values arrays would be
 maintained during accumulation. It is probably not a real problem for most applications, but be
 aware of this. If, for example, an application at a certain point in time removes an index
 entirely in order to recreate it, or, if it removed all the documents from the index in order to
 re-populate it, it also makes sense in this opportunity to remove the taxonomy index and create a
 new, fresh one, without the unused categories.

 <h2 id="facet_config">Facet Configuration</h2>

 <p>Facet configuration controls how categories and facets are indexed and searched. It is not
 required to provide any parameters, as there are ready to use working defaults for everything.
 However, some aspects are configurable and can be modified by providing altered facet
 configuration parameters for search and indexing.

 <p>The most often used configuration options are:

 <ul>
   <li><a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.html?is-external=true#setDrillDownTermsIndexing(java.lang.String,org.apache.lucene.facet.FacetsConfig.DrillDownTermsIndexing)" title="class or interface in org.apache.lucene.facet" class="externalLink">Drill-Down Terms Indexing</a>
       level - defines what is written to <a href="#category_terms_field">Category Terms
       Field</a>.
   <li><a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.html?is-external=true#setHierarchical(java.lang.String,boolean)" title="class or interface in org.apache.lucene.facet" class="externalLink">Hierarchical</a> - Mark selected dimension as hierarchical, to support counting
       sub-categories.
   <li><a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.html?is-external=true#setMultiValued(java.lang.String,boolean)" title="class or interface in org.apache.lucene.facet" class="externalLink">MultiValued</a> - Allow multiple values per document per dimension. Multi value support
       requires storing all parent category ordinals in the <a href="#category_list_field">category list field</a> for accurate counting, so it has to be
       configured explicitly.
 </ul>

 <h2 id="advanced">Advanced Faceted Examples</h2>

 <p>We now provide examples for more advanced facet indexing and search, such as drilling-down on
 facet values and multiple category lists.

 <h3 id="drill_down">Drill-Down with Regular Facets</h3>

 <p>Drill-down allows users to focus on part of the results. Assume a commercial sport equipment
 site where a user is searching for a tennis racquet. The user issues the query <i>tennis
 racquet</i> and as result is shown a page with 10 tennis racquets, by various providers, of
 various types and prices. In addition, the site UI shows to the user a break-down of all
 available racquets by price and make. The user now decides to focus on racquets made by
 <i>Head</i>, and will now be shown a new page, with 10 Head racquets, and new break down of the
 results into racquet types and prices. Additionally, the application can choose to display a new
 breakdown, by racquet weights. This step of moving from results (and facet statistics) of the
 entire (or larger) data set into a portion of it by specifying a certain category, is what we
 call <i>Drilldown</i>.

 <p>You can find code example for drill-down in <a href="SimpleFacetsExample.html#drillDown()"><code>SimpleFacetsExample.drillDown()</code></a>, see <a href="../../../../../src-html/org/apache/lucene/demo/facet/SimpleFacetsExample.html">SimpleFacetsExample.java
 source code</a>.

 <h3 id="multi-category_list">Multiple Category Lists</h3>

 The default is to maintain all <a href="#category_list_field">category list</a> information in a
 single field. While this will suit most applications, in some situations an application may wish
 to use multiple fields, for example, when the distribution of some category values is different
 from that of other categories and calls for using a different encoding, more efficient for the
 specific distribution. Another example is when most facets are rarely used while some facets are
 used very heavily, so an application may opt to maintain the latter in memory - and in order to
 keep memory footprint lower it is useful to maintain only those heavily used facets in a separate
 category list.

 <p>You can find full example code in <a href="../../../../../src-html/org/apache/lucene/demo/facet/MultiCategoryListsFacetsExample.html">MultiCategoryListsFacetsExample.java</a>.

 <p>First we need to change facets configuration to use different fields for different dimensions.

 <p>This will cause the Author categories to be maintained in one category list field, and Publish
 Date facets to be maintained in a another field. Note that any other category, if encountered,
 will still be maintained in the default field.

 <p>These non-default facets parameters should now be used both at indexing and search time, so
 make sure you use the same or similar <a href="../../../../../../facet/org/apache/lucene/facet/FacetsConfig.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>FacetsConfig</code></a> in both cases.

 <h3 id="sampling">Sampling</h3>

 Faceted search through a large collection of documents with large numbers of facets altogether
 and/or large numbers of facets per document is challenging performance wise, either in CPU, RAM,
 or both.

 <p>Facet sampling allows to accumulate facets over a sample of the matching documents set. In
 many cases, once top facets are found over the sample set, exact accumulations are computed for
 those facets only, this time over the entire matching document set.

 <p>Sampling support is implemented in <a href="../../../../../../facet/org/apache/lucene/facet/RandomSamplingFacetsCollector.html?is-external=true" title="class or interface in org.apache.lucene.facet" class="externalLink"><code>RandomSamplingFacetsCollector</code></a>.

 <h2 id="concurrent_indexing_search">Concurrent Indexing and Search</h2>

 <p>Sometimes, indexing is done once, and when the index is fully prepared, searching starts.
 However, in most real applications indexing is <i>incremental</i> (new data comes in once in a
 while, and needs to be indexed), and indexing often needs to happen while searching is continuing
 at full steam.

 <p>Luckily, Lucene supports multiprocessing - one process writing to an index while another is
 reading from it. One of the key insights behind how Lucene allows multiprocessing is <i>Point In
 Time</i> semantics. The idea is that when an <a href="../../../../../../core/org/apache/lucene/index/IndexReader.html?is-external=true" title="class or interface in org.apache.lucene.index" class="externalLink"><code>IndexReader</code></a> is
 opened, it gets a view of the index at the <i>point in time</i> it was opened. If an <a href="../../../../../../core/org/apache/lucene/index/IndexWriter.html?is-external=true" title="class or interface in org.apache.lucene.index" class="externalLink"><code>IndexWriter</code></a> in a different process or thread modifies the index, the
 reader does not know about it until a new <a href="../../../../../../core/org/apache/lucene/index/IndexReader.html?is-external=true" title="class or interface in org.apache.lucene.index" class="externalLink"><code>IndexReader</code></a> is opened.

 <p>In faceted search, we complicate things somewhat by adding a second index - the taxonomy
 index. The taxonomy API also follows point-in-time semantics, but this is not quite enough. Some
 attention must be paid by the user to keep those two indexes consistently in sync.

 <p>The main index refers to category numbers defined in the taxonomy index. Therefore, it is
 important that we open the <a href="../../../../../../facet/org/apache/lucene/facet/taxonomy/TaxonomyReader.html?is-external=true" title="class or interface in org.apache.lucene.facet.taxonomy" class="externalLink"><code>TaxonomyReader</code></a> <i>after</i>
 opening the <a href="../../../../../../core/org/apache/lucene/index/IndexReader.html?is-external=true" title="class or interface in org.apache.lucene.index" class="externalLink"><code>IndexReader</code></a>. Moreover, every time an IndexReader is
 reopened, the TaxonomyReader needs to be <a href="../../../../../../facet/org/apache/lucene/facet/taxonomy/TaxonomyReader.html?is-external=true#openIfChanged(T)" title="class or interface in org.apache.lucene.facet.taxonomy" class="externalLink">reopened</a> as well.

 <p>But there is one extra caution: whenever the application deems it has written enough
 information worthy a commit, it must <b>first</b> call <a href="../../../../../../core/org/apache/lucene/index/TwoPhaseCommit.html?is-external=true#commit()" title="class or interface in org.apache.lucene.index" class="externalLink"><code>TwoPhaseCommit.commit()</code></a> and only <b>after</b> that call <a href="../../../../../../core/org/apache/lucene/index/IndexWriter.html?is-external=true#commit()" title="class or interface in org.apache.lucene.index" class="externalLink"><code>IndexWriter.commit()</code></a>. Closing the indices should also be done in this
 order - <b>first</b> close the taxonomy, and only <b>after</b> that close the index.

 <p>Note that the above discussion assumes that the underlying file-system on which the index and
 the taxonomy are stored respects ordering: if index A is written before index B, then any reader
 finding a modified index B will also see a modified index A.

 <h2 id="demo">All demo packages and classes</h2></div>
</section>
<ul class="blockList">
<li class="blockList">
<table class="typeSummary">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="AssociationsFacetsExample.html" title="class in org.apache.lucene.demo.facet">AssociationsFacetsExample</a></th>
<td class="colLast">
<div class="block">Shows example usage of category associations.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="CustomFacetSetExample.html" title="class in org.apache.lucene.demo.facet">CustomFacetSetExample</a></th>
<td class="colLast">
<div class="block">Shows usage of indexing and searching <a href="../../../../../../facet/org/apache/lucene/facet/facetset/FacetSetsField.html?is-external=true" title="class or interface in org.apache.lucene.facet.facetset" class="externalLink"><code>FacetSetsField</code></a> with a custom <a href="../../../../../../facet/org/apache/lucene/facet/facetset/FacetSet.html?is-external=true" title="class or interface in org.apache.lucene.facet.facetset" class="externalLink"><code>FacetSet</code></a>
 implementation.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="CustomFacetSetExample.TemperatureOnlyFacetSetMatcher.html" title="class in org.apache.lucene.demo.facet">CustomFacetSetExample.TemperatureOnlyFacetSetMatcher</a></th>
<td class="colLast">
<div class="block">A <a href="../../../../../../facet/org/apache/lucene/facet/facetset/FacetSetMatcher.html?is-external=true" title="class or interface in org.apache.lucene.facet.facetset" class="externalLink"><code>FacetSetMatcher</code></a> which matches facet sets only by their temperature dimension,
 ignoring the date.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="CustomFacetSetExample.TemperatureReadingFacetSet.html" title="class in org.apache.lucene.demo.facet">CustomFacetSetExample.TemperatureReadingFacetSet</a></th>
<td class="colLast">
<div class="block">A <a href="../../../../../../facet/org/apache/lucene/facet/facetset/FacetSet.html?is-external=true" title="class or interface in org.apache.lucene.facet.facetset" class="externalLink"><code>FacetSet</code></a> which encodes a temperature reading in a date (long) and degrees (celsius;
 float).</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="DistanceFacetsExample.html" title="class in org.apache.lucene.demo.facet">DistanceFacetsExample</a></th>
<td class="colLast">
<div class="block">Shows simple usage of dynamic range faceting, using the expressions module to calculate distance.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="ExpressionAggregationFacetsExample.html" title="class in org.apache.lucene.demo.facet">ExpressionAggregationFacetsExample</a></th>
<td class="colLast">
<div class="block">Shows facets aggregation by an expression.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="MultiCategoryListsFacetsExample.html" title="class in org.apache.lucene.demo.facet">MultiCategoryListsFacetsExample</a></th>
<td class="colLast">
<div class="block">Demonstrates indexing categories into different indexed fields.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="RangeFacetsExample.html" title="class in org.apache.lucene.demo.facet">RangeFacetsExample</a></th>
<td class="colLast">
<div class="block">Shows simple usage of dynamic range faceting.</div>
</td>
</tr>
<tr class="altColor">
<th class="colFirst" scope="row"><a href="SimpleFacetsExample.html" title="class in org.apache.lucene.demo.facet">SimpleFacetsExample</a></th>
<td class="colLast">
<div class="block">Shows simple usage of faceted indexing and search.</div>
</td>
</tr>
<tr class="rowColor">
<th class="colFirst" scope="row"><a href="SimpleSortedSetFacetsExample.html" title="class in org.apache.lucene.demo.facet">SimpleSortedSetFacetsExample</a></th>
<td class="colLast">
<div class="block">Shows simple usage of faceted indexing and search, using <a href="../../../../../../facet/org/apache/lucene/facet/sortedset/SortedSetDocValuesFacetField.html?is-external=true" title="class or interface in org.apache.lucene.facet.sortedset" class="externalLink"><code>SortedSetDocValuesFacetField</code></a> and
 <a href="../../../../../../facet/org/apache/lucene/facet/sortedset/SortedSetDocValuesFacetCounts.html?is-external=true" title="class or interface in org.apache.lucene.facet.sortedset" class="externalLink"><code>SortedSetDocValuesFacetCounts</code></a>.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</main>
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small><i>Copyright &copy; 2000-2023 Apache Software Foundation. All Rights Reserved.</i></small></p>
</footer>
</body>
</html>
